<template>
    <div class="sidebar">
        <div
            class="sidebar-backdrop"
            @click="closeSidebarPanel"
            v-if="isPanelOpen"
        ></div>
        <transition name="slide">
            <div v-if="isPanelOpen" class="sidebar-panel">
                <div class="container ps-4 pb-4">
                    <a class="site-primary-btn px-4 px-lg-5" href="/admin"
                        >Registrati o accedi</a
                    >
                </div>

                <!-- SMALL ASIDE -->
                <div class="aside row h-100">
                    <aside
                        class="overflow-auto py-5 aside-wrapper col-md-4 col-lg-3 col-xxl-2 h-100"
                    >
                        <div class="container">
                            <h5 class="pt-3 ps-3 pb-3">
                                Filtra per tipologia:
                            </h5>

                            <div
                                class="position-relative"
                                v-for="(el, index) in mainArray"
                                :key="`typology-${index}`"
                            >
                                <label
                                    class="custom-checkbox pb-2 ps-3"
                                    :for="el.name"
                                >
                                    <!-- :checked="selectedTypology == el.id" -->
                                    <!-- v-model="checkedTypologies" -->
                                    <input
                                        :checked="selectedTypology == el.name"
                                        type="checkbox"
                                        :value="el.name"
                                        :name="el.name"
                                        :id="el.name"
                                        @click="
                                            putTypologies(el.name),
                                                getTypologyFromAside(
                                                    checkedTypologies
                                                )
                                        "
                                    />
                                    <div class="checkbox m-2">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-6 w-6"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                            stroke="currentColor"
                                            stroke-width="2"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                d="M5 13l4 4L19 7"
                                            />
                                        </svg>
                                    </div>
                                    {{ el.name }}
                                </label>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        </transition>
    </div>
</template>

<script>
import { store, mutations } from "../slide-aside";

export default {
    name: "SlideSidebar",
    data: () => ({
        checkedTypologies: [],
    }),
    props: {
        mainArray: Array,
        selectedTypology: String,
    },
    created() {
        this.getTypologyFromAside;
    },
    computed: {
        isPanelOpen() {
            return store.isNavOpen;
        },
    },
    watch: {
        selectedTypology: function (newVal, oldVal) {
            this.checkedTypologies = [newVal];
        },
    },
    methods: {
        closeSidebarPanel: mutations.toggleNav,
        putTypologies(typo) {
            if (!this.checkedTypologies.includes(typo)) {
                this.checkedTypologies.push(typo);
            } else if (this.checkedTypologies.includes(typo)) {
                for (let i = 0; i < this.checkedTypologies.length; i++) {
                    if (this.checkedTypologies[i] == typo) {
                        this.checkedTypologies.splice(i, 1);
                    }
                }
            }
        },
        getTypologyFromAside(typology) {
            this.$emit("getTypologyFromAside", typology);
        },
    },
};
</script>

<style lang="scss" scoped>
@import "../../sass/variables.scss";

.slide-enter-active,
.slide-leave-active {
    transition: transform 0.2s ease;
}

.slide-enter,
.slide-leave-to {
    transform: translateX(-100%);
    transition: all 150ms ease-in 0s;
}

.sidebar-backdrop {
    background-color: rgba(0, 0, 0, 0.5);
    width: 100vw;
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    cursor: pointer;
}

.sidebar-panel {
    overflow-y: auto;
    background-color: white;
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    z-index: 999;
    padding: 2rem 20px 2rem 20px;
    width: 300px;
}

// .aside-wrapper {
//     box-shadow: rgba(17, 17, 26, 0.05) 0px 1px 0px,
//         rgba(17, 17, 26, 0.1) 0px 0px 8px;
//     padding-top: 100px;
// }

.custom-checkbox {
    display: flex;
    align-items: center;
    line-height: 24px;
    font-size: 16px;
    cursor: pointer;
    &:hover .checkbox {
        border: 2px solid $site-col-3;
    }
}

.custom-checkbox input {
    display: none;
}

.custom-checkbox input:checked + .checkbox {
    background-color: $site-col-3;
    border: 0;
}

.custom-checkbox input:checked + .checkbox svg {
    display: flex;
    color: white;
}

.checkbox {
    width: 18px;
    height: 18px;
    background-color: white;
    border: 2px solid grey;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.checkbox svg {
    display: none;
}

// @media all and (max-width: 767px) {
//     .aside {
//         display: none;
//     }
// }
</style>
